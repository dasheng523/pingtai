<extend name="Goods/template" />

<block name="content">

    <h1 class="main-color text-center">确认订单</h1>

    <div class="inline-box">

        <div class="panel box margin-top flex flex-align-center" id="selectAddress">
            <div class="flex-1" id="addressBox">
                点击选择配送地址<span class="small-text">（仅限北流市区）</span>
            </div>
            <div><i class="iconfont">&#xe60e;</i></div>
        </div>

        <div class="panel box margin-top">
            <div class="list">
                <volist name="order_goods" id="info">
                    <div class="item flex">
                        <div class="flex-1">{$info['goods_name']} × {$info['order_amount']} 瓶</div>
                        <div class="">￥{$info['price'] * $info['order_amount']}</div>
                    </div>
                </volist>
            </div>
            <div class="text-right" style="margin: 10px 0;">
                总计：￥{$info['price'] * $info['order_amount']}
            </div>
        </div>

        <input id="order_id" value="{$order_id}" name="order_id" type="hidden">

        <div class="margin-top30">
            <a class="btn main-btn" href="javascript:;" id="payBtn">立即支付</a>
        </div>
    </div>

</block>

<block name="script">
    <script>
        wx.config(jsConfig);
        $('#selectAddress').click(function(){
            wx.openAddress({
                success : function(res){
                    $.post("{:UC('Goods/saveAddress')}",res);
                    var address = "姓名："+res.userName+"<br>电话："+res.telNumber+"<br>地址："+res.detailInfo;
                    $('#addressBox').html(address);
                },
                cancel :function(res){
                    console.log(res);
                }
            });
        });

        $('#payBtn').click(function(){
            var orderId = $('#order_id').val();
            $.post("{:UC('Goods/prePay')}",{orderId:orderId},function(res){
                res.success = function(payRes){
                    alert('支付成功');
                    window.location.href = "{:UC('Goods/orderList')}";
                };
                wx.chooseWXPay(res);
            },'json');
        });
    </script>
</block>